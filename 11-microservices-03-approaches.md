# Домашнее задание к занятию «Микросервисы: подходы»

Вы работаете в крупной компании, которая строит систему на основе микросервисной архитектуры.
Вам как DevOps-специалисту необходимо выдвинуть предложение по организации инфраструктуры для разработки и эксплуатации.


## Задача 1: Обеспечить разработку

Предложите решение для обеспечения процесса разработки: хранение исходного кода, непрерывная интеграция и непрерывная поставка. 
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:
- облачная система;
- система контроля версий Git;
- репозиторий на каждый сервис;
- запуск сборки по событию из системы контроля версий;
- запуск сборки по кнопке с указанием параметров;
- возможность привязать настройки к каждой сборке;
- возможность создания шаблонов для различных конфигураций сборок;
- возможность безопасного хранения секретных данных (пароли, ключи доступа);
- несколько конфигураций для сборки из одного репозитория;
- кастомные шаги при сборке;
- собственные докер-образы для сборки проектов;
- возможность развернуть агентов сборки на собственных серверах;
- возможность параллельного запуска нескольких сборок;
- возможность параллельного запуска тестов.

Обоснуйте свой выбор.

### Ответ:
Для обеспечения процесса разработки с указанными требованиями я предлагаю использовать следующее решение:

GitLab: GitLab предоставляет облачную систему контроля версий Git, которая позволяет хранить исходный код проекта. Он также предоставляет возможность создания репозиториев для каждого сервиса, что удовлетворяет требованию о наличии репозитория на каждый сервис.

GitLab CI/CD: GitLab CI/CD является встроенным инструментом в GitLab, который обеспечивает непрерывную интеграцию и непрерывную поставку. Он позволяет настроить запуск сборки по событию из системы контроля версий (например, при каждом коммите в репозиторий), а также запуск сборки по кнопке с указанием параметров. Кроме того, GitLab CI/CD предоставляет возможность привязать настройки к каждой сборке и создавать шаблоны для различных конфигураций сборок.

GitLab Vault: GitLab Vault - это инструмент для безопасного хранения секретных данных, таких как пароли и ключи доступа. Он интегрируется с GitLab CI/CD и позволяет безопасно передавать секреты в процессе сборки и развертывания.

Docker: Docker позволяет создавать собственные докер-образы для сборки проектов. Это позволяет упростить и стандартизировать процесс сборки, а также обеспечить портативность и изолированность среды выполнения.

GitLab Runner: GitLab Runner - это агент сборки, который может быть развернут на собственных серверах. Он позволяет выполнить сборку проекта на удаленной машине, что обеспечивает гибкость и масштабируемость процесса сборки.

Параллельный запуск сборок и тестов: GitLab CI/CD поддерживает параллельный запуск нескольких сборок и тестов. Это позволяет ускорить процесс сборки и тестирования, особенно при наличии большого количества сервисов или тестов.

Все эти компоненты взаимодействуют между собой, обеспечивая непрерывную интеграцию и непрерывную поставку проекта. GitLab предоставляет удобный интерфейс для настройки и управления процессом разработки, а также интеграцию с другими инструментами разработки, такими как системы отслеживания ошибок или уведомления. Комбинация GitLab и связанных инструментов обеспечивает гибкость, безопасность и эффективность разработки при соблюдении всех указанных требований.

## Задача 2: Логи

Предложите решение для обеспечения сбора и анализа логов сервисов в микросервисной архитектуре.
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:
- сбор логов в центральное хранилище со всех хостов, обслуживающих систему;
- минимальные требования к приложениям, сбор логов из stdout;
- гарантированная доставка логов до центрального хранилища;
- обеспечение поиска и фильтрации по записям логов;
- обеспечение пользовательского интерфейса с возможностью предоставления доступа разработчикам для поиска по записям логов;
- возможность дать ссылку на сохранённый поиск по записям логов.

Обоснуйте свой выбор.
### Ответ:  
Для обеспечения сбора и анализа логов сервисов в микросервисной архитектуре я предлагаю использовать следующее решение:

Elasticsearch: Elasticsearch является распределенным поисковым и аналитическим движком, который может использоваться для хранения и индексации логов. Он обеспечивает возможность сбора логов со всех хостов, обслуживающих систему, и гарантированную доставку логов до центрального хранилища. Elasticsearch также обеспечивает мощный механизм поиска и фильтрации по записям логов.

Logstash: Logstash - это инструмент для сбора, обработки и отправки логов в различные системы хранения, включая Elasticsearch. Logstash позволяет минимизировать требования к приложениям, собирая логи из stdout и отправляя их в Elasticsearch для дальнейшего анализа. Он также обеспечивает возможность фильтрации и преобразования логов перед их отправкой.

Kibana: Kibana - это инструмент визуализации и анализа данных, который может быть использован для создания пользовательского интерфейса для поиска и анализа записей логов. Он интегрируется с Elasticsearch и позволяет разработчикам и другим пользователям выполнять поиск по записям логов, применять фильтры и создавать сохраненные поиски. Кроме того, Kibana позволяет создавать ссылки на сохраненные поиски, что удовлетворяет требованию предоставления доступа к сохраненным поискам.

Это решение обеспечивает сбор логов со всех хостов в микросервисной архитектуре, их доставку в центральное хранилище, а также возможность поиска, фильтрации и анализа записей логов. Elasticsearch и Logstash обеспечивают надежный механизм сбора и передачи логов, а Kibana предоставляет удобный пользовательский интерфейс для доступа к данным логов. Вместе эти компоненты обеспечивают эффективное решение для сб

## Задача 3: Мониторинг

Предложите решение для обеспечения сбора и анализа состояния хостов и сервисов в микросервисной архитектуре.
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:
- сбор метрик со всех хостов, обслуживающих систему;
- сбор метрик состояния ресурсов хостов: CPU, RAM, HDD, Network;
- сбор метрик потребляемых ресурсов для каждого сервиса: CPU, RAM, HDD, Network;
- сбор метрик, специфичных для каждого сервиса;
- пользовательский интерфейс с возможностью делать запросы и агрегировать информацию;
- пользовательский интерфейс с возможностью настраивать различные панели для отслеживания состояния системы.

Обоснуйте свой выбор.
### Ответ:  
Для обеспечения сбора и анализа состояния хостов и сервисов в микросервисной архитектуре я предлагаю использовать следующее решение:

Prometheus: Prometheus - это система мониторинга и алертинга, которая обеспечивает сбор и хранение метрик из различных источников. Он позволяет собирать метрики состояния ресурсов хостов (CPU, RAM, HDD, Network) и метрики потребляемых ресурсов для каждого сервиса. Prometheus также предоставляет возможность сбора специфичных для каждого сервиса метрик.

Grafana: Grafana - это инструмент для визуализации данных и построения графиков на основе собранных метрик. Он обеспечивает пользовательский интерфейс, позволяющий делать запросы к метрикам и агрегировать информацию. С помощью Grafana можно создавать настраиваемые панели для отслеживания состояния системы.

Node Exporter: Node Exporter - это экспортер метрик для сбора информации о состоянии хоста. Он собирает метрики CPU, RAM, HDD, Network и другие системные метрики и предоставляет их в формате, понятном для Prometheus.

Exporter для сервисов: Для каждого сервиса можно использовать соответствующий экспортер метрик, который собирает специфичные метрики для данного сервиса. Например, для баз данных можно использовать экспортеры Prometheus, такие как PostgreSQL Exporter или MySQL Exporter.

Взаимодействие между компонентами: Prometheus собирает метрики от Node Exporter и экспортеров для сервисов и сохраняет их в своей временной базе данных. Grafana использует Prometheus в качестве источника данных для визуализации и анализа метрик.

Это решение обеспечивает сбор и анализ метрик состояния хостов и сервисов в микросервисной архитектуре. Prometheus позволяет собирать метрики со всех хостов и сервисов, сохранять их и обеспечивать доступ к ним. Grafana предоставляет пользовательский интерфейс для визуализации и анализа метрик. Node Exporter и экспортеры для сервисов обеспечивают сбор специфичных метрик для каждого компонента. Это решение позволяет отслеживать состояние системы, анализировать производительность и принимать меры по оптимизации и улучшению работы приложений в микросервисной архитектуре.

## Задача 4: Логи * (необязательная)

Продолжить работу по задаче API Gateway: сервисы, используемые в задаче, пишут логи в stdout. 

Добавить в систему сервисы для сбора логов Vector + ElasticSearch + Kibana со всех сервисов, обеспечивающих работу API.

### Результат выполнения: 

docker compose файл, запустив который можно перейти по адресу http://localhost:8081, по которому доступна Kibana.
Логин в Kibana должен быть admin, пароль qwerty123456.


## Задача 5: Мониторинг * (необязательная)

Продолжить работу по задаче API Gateway: сервисы, используемые в задаче, предоставляют набор метрик в формате prometheus:

- сервис security по адресу /metrics,
- сервис uploader по адресу /metrics,
- сервис storage (minio) по адресу /minio/v2/metrics/cluster.

Добавить в систему сервисы для сбора метрик (Prometheus и Grafana) со всех сервисов, обеспечивающих работу API.
Построить в Graphana dashboard, показывающий распределение запросов по сервисам.

### Результат выполнения: 

docker compose файл, запустив который можно перейти по адресу http://localhost:8081, по которому доступна Grafana с настроенным Dashboard.
Логин в Grafana должен быть admin, пароль qwerty123456.

---

### Как оформить ДЗ?

Выполненное домашнее задание пришлите ссылкой на .md-файл в вашем репозитории.

---
